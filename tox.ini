# How it works:
# - `tox` (without arguments) runs lint + format-check + tests (py313).
# - `tox -e lint` runs only the linter.
# - `tox -e format` applies formatting locally (modifies files).
# - `tox -e py310,py311` runs tests on other Python versions if available.

[tox]
requires = tox>=4.11
# Default run: lint + format-check + tests on py313
envlist = lint, format-check, py313
skip_missing_interpreters = true

[testenv]
description = Run tests with coverage (HTML local, term+XML always)
setenv =
    COVERAGE_PROCESS_START = {toxinidir}/.coveragerc
# Important: let tox build and install the package defined in pyproject.toml
# so all runtime dependencies (astropy, numpy, matplotlib, scikit-learn, etc.)
# are installed automatically. We only add test tools here.
extras =
deps =
    pytest>=7
    pytest-cov>=4
    hypothesis
commands =
    pytest --cov=pointing --cov-report=term-missing --cov-report=xml --cov-report=html

[testenv:lint]
description = Ruff check (lint only)
skip_install = true
deps = ruff>=0.4
commands =
    ruff check --select E --line-length 88 .

[testenv:format]
description = Ruff format (LOCAL ONLY; modifies files)
skip_install = true
deps = ruff>=0.4
commands =
    ruff format --line-length 88 .

[testenv:format-check]
description = Ruff format check (CI-safe; no changes)
skip_install = true
deps = ruff>=0.4
commands =
    ruff format --check --line-length 88 .
